(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){G=t}function r(t){Q=t}function o(){return function(){process.nextTick(a)}}function i(){return function(){B(a)}}function s(){var t=0,e=new X(a),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=a,function(){t.port2.postMessage(0)}}function c(){return function(){setTimeout(a,1)}}function a(){for(var t=0;J>t;t+=2){var e=tt[t],n=tt[t+1];e(n),tt[t]=void 0,tt[t+1]=void 0}J=0}function f(){try{var t=require,e=t("vertx");return B=e.runOnLoop||e.runOnContext,i()}catch(n){return c()}}function l(t,e){var n=this,r=new this.constructor(p);void 0===r[rt]&&k(r);var o=n._state;if(o){var i=arguments[o-1];Q(function(){x(o,r,i,n._result)})}else E(n,r,t,e);return r}function h(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return g(n,t),n}function p(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(e){return ut.error=e,ut}}function y(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function m(t,e,n){Q(function(t){var r=!1,o=y(n,e,function(n){r||(r=!0,e!==n?g(t,n):S(t,n))},function(e){r||(r=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,j(t,o))},t)}function b(t,e){e._state===it?S(t,e._result):e._state===st?j(t,e._result):E(e,void 0,function(e){g(t,e)},function(e){j(t,e)})}function w(t,n,r){n.constructor===t.constructor&&r===et&&constructor.resolve===nt?b(t,n):r===ut?j(t,ut.error):void 0===r?S(t,n):e(r)?m(t,n,r):S(t,n)}function g(e,n){e===n?j(e,_()):t(n)?w(e,n,v(n)):S(e,n)}function A(t){t._onerror&&t._onerror(t._result),T(t)}function S(t,e){t._state===ot&&(t._result=e,t._state=it,0!==t._subscribers.length&&Q(T,t))}function j(t,e){t._state===ot&&(t._state=st,t._result=e,Q(A,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+it]=n,o[i+st]=r,0===i&&t._state&&Q(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?x(n,r,o,i):o(i);t._subscribers.length=0}}function M(){this.error=null}function P(t,e){try{return t(e)}catch(n){return ct.error=n,ct}}function x(t,n,r,o){var i,s,u,c,a=e(r);if(a){if(i=P(r,o),i===ct?(c=!0,s=i.error,i=null):u=!0,n===i)return void j(n,d())}else i=o,u=!0;n._state!==ot||(a&&u?g(n,i):c?j(n,s):t===it?S(n,i):t===st&&j(n,i))}function C(t,e){try{e(function(e){g(t,e)},function(e){j(t,e)})}catch(n){j(t,n)}}function O(){return at++}function k(t){t[rt]=at++,t._state=void 0,t._result=void 0,t._subscribers=[]}function Y(t){return new _t(this,t).promise}function q(t){var e=this;return new e(I(t)?function(n,r){for(var o=t.length,i=0;o>i;i++)e.resolve(t[i]).then(n,r)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function F(t){var e=this,n=new e(p);return j(n,t),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(t){this[rt]=O(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&D(),this instanceof L?C(this,t):K())}function N(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[rt]||k(this.promise),Array.isArray(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):j(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function W(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=pt)}var z;z=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B,G,H,I=z,J=0,Q=function(t,e){tt[J]=t,tt[J+1]=e,J+=2,2===J&&(G?G(a):H())},R="undefined"!=typeof window?window:void 0,V=R||{},X=V.MutationObserver||V.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,tt=new Array(1e3);H=Z?o():X?s():$?u():void 0===R&&"function"==typeof require?f():c();var et=l,nt=h,rt=Math.random().toString(36).substring(16),ot=void 0,it=1,st=2,ut=new M,ct=new M,at=0,ft=Y,lt=q,ht=F,pt=L;L.all=ft,L.race=lt,L.resolve=nt,L.reject=ht,L._setScheduler=n,L._setAsap=r,L._asap=Q,L.prototype={constructor:L,then:et,"catch":function(t){return this.then(null,t)}};var _t=N;N.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===ot&&t>n;n++)this._eachEntry(e[n],n)},N.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===nt){var o=v(t);if(o===et&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===pt){var i=new n(p);w(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){e(t)}),e)}else this._willSettleAt(r(t),e)},N.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===ot&&(this._remaining--,t===st?j(r,n):this._result[e]=n),0===this._remaining&&S(r,this._result)},N.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){n._settledAt(it,e,t)},function(t){n._settledAt(st,e,t)})};var dt=W,vt={Promise:pt,polyfill:dt};"function"==typeof define&&define.amd?define(function(){return vt}):"undefined"!=typeof module&&module.exports?module.exports=vt:"undefined"!=typeof this&&(this.ES6Promise=vt),dt()}).call(this);var today=Date.now();var nfids={};var ofids={};var rxfids={};var incidents={};var airtanker;var dozer;var engine;var crews;var fixedWing;var IMTs;var helicopter;var lightning6;var lightning12;var lightning24;var resItems=[];var resources=document.getElementById('resources');resources.style.display='none';var Resources=document.getElementById('resources').getElementsByTagName('strong');var ResourcesP=document.getElementById('resources').getElementsByTagName('p');var resIds=[' Airtankers',' Dozers',' Engines',' Crews',' Fixed-Wing',' IMTs',' Helicopters'];var legend=document.getElementById('legend').getElementsByTagName('text');var swipe=document.getElementById('swipe');var slide=document.getElementById('slide');var fullscreen=document.getElementById('fullscreen');var sidepanel=document.getElementById('sidepanel');var side1=document.getElementById('side1');var maps=document.getElementById('map2d');var fovStyle;var mlabKey='PJfhY3w2U58ZczDkxR-dsqlo_9THZblN';var mapboxToken='pk.eyJ1IjoicnRpcHBldHRzIiwiYSI6ImNpb2huaWtuNDAwNnF1NW0xNWFhYXJiM20ifQ.-c3uBsqfQoJgd3gG4TbNLw#0/0/0/0';var bingToken='Al2oBjQ_opovK7NsjQhkWaPvCOJMm0fHal4-iW0JOj8IuMft5kpLVX_Ok7vriTzn';var mapzenKey='vector-tiles-kPYqqBF';function timeStamp(input){var now=new Date(input);var date=[now.getFullYear(),now.getMonth()+1,now.getDate()];var time=[now.getHours(),now.getMinutes()];time[0]=time[0]<10?'0'+time[0]:time[0];time[1]=time[1]<10?'0'+time[1]:time[1];date[1]=date[1]<10?'0'+date[1]:date[1];date[2]=date[2]<10?'0'+date[2]:date[2];return date.join('')+time.join('');}function resSort(array){return array.map(function(current_value,index,initial_array){var oo={};var key=current_value.attributes.IncName;var Name=current_value.attributes.Name;var MobDate=current_value.attributes.MobDate;var ResProvAgency=current_value.attributes.ResProvAgency;oo[key]={"Name":'<span>Name: '+Name+'</span>',"Mob Date":'<br><span>&nbsp;&nbsp;&nbsp;&nbsp;Mob Date: '+new Date(parseInt(MobDate)).toLocaleString()+'</span>',"Agency":'<br><span>&nbsp;&nbsp;&nbsp;&nbsp;Agency: '+ResProvAgency+'</span><br>'};return oo;});}var irwin;var egp;var options={method:String,url:String,params:String|Object,headers:Object};function ajax(options){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.open(options.method,options.url);xhr.responseType='';xhr.onload=function(){if(this.status<=200&&this.status<300){resolve(xhr.response);}else{reject({status:this.status,statusText:xhr.statusText});}};xhr.onerror=function(){reject({status:this.status,statusText:xhr.statusText});};if(options.headers){Object.keys(options.headers).forEach(function(key){xhr.setRequestHeader(key,options.headers[key]);});};var params=options.params;if(params&&typeof params==='object'){params=Object.keys(params).map(function(key){return encodeURIComponent(key)+'='+encodeURIComponent(params[key]);}).join('&');};xhr.send(params);});}var addVectorLayerSource=function(config,sourceObject,layer){return new Promise(function(success,failure){var source=ajax(config).then(function(response){sourceObject.url=sourceObject.url+JSON.parse(response).token;var sourceName=new ol.source.Vector(sourceObject);return{newSource:sourceName,newLayer:layer};});source==null?failure(source):success(source);});}
function loadSource(source){source['newLayer'].setSource(source['newSource']);}function noToken(source){console.log('Could not get token');}var perims=[];var gsPerims;ajax({method:'POST',url:'https://egp.nwcg.gov/arcgis/tokens/',params:{f:'json',username:EGP1,password:EGP2,client:'referer',referer:'https://gacc.nifc.gov/gbcc/',expiration:'1440'},headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(function(secondValue){egp=JSON.parse(secondValue).token;function loadjsfile(filename,filetype){if(filetype=="js"){var fileref=document.createElement('script')
fileref.setAttribute("type","text/javascript")
fileref.setAttribute("src",filename)}if(typeof fileref!="undefined")document.getElementsByTagName("head")[0].appendChild(fileref)}loadjsfile("firecesium/examples/selection2.js","js");refresh.innerHTML=new Date(Date.now()).toLocaleString().split(', ')[1];return ajax({method:'GET',url:'https://api.mlab.com/api/1/databases/fuelzonemaps/collections/createdfeatures?l=1&apiKey='+mlabKey,headers:{'Content-Type':'application/json'}});}).then(function(thirdValue){perims=JSON.parse(thirdValue)
gsPerims=perims[0];}).catch(function(error){console.error('damnit.',error.statusText);});var rxFiresStyleCache={};var rxFiresStyleFunction=function(feature){var discovery=feature.get('FireDiscoveryDateTime');var acres=feature.get('DailyAcres')?feature.get('DailyAcres'):feature.get('DiscoveryAcres');var radius=(acres<=18.5)?3.5:1.2*Math.log(acres);var style=rxFiresStyleCache[radius];if(!style){style=new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:'rgba(253,2,125,'+opacity(acres)+')'}),stroke:new ol.style.Stroke({color:'fuchsia',width:3}),radius:radius})});rxFiresStyleCache[radius]=style;}return(discovery>=(today-365*86400000)&&discovery<(today+86400000))?style:fireStyles['Point'];}
var rxFiresLayer=new ol.layer.Vector({title:'Prescribed Fires',source:new ol.source.Vector({format:new ol.format.GeoJSON(),url:'https://gbcc.us/rxfires.geojson'}),visible:true,wrapX:false,style:rxFiresStyleFunction});var newFiresStyleCache={};var newFiresStyleFunction=function(feature){var discovery=feature.get('FireDiscoveryDateTime');var acres=feature.get('DailyAcres')?feature.get('DailyAcres'):feature.get('DiscoveryAcres');var style=newFiresStyleCache[acres];if(!style){style=new ol.style.Style({image:new ol.style.Circle({radius:(acres<=18.5)?3.5:1.2*Math.log(acres),fill:new ol.style.Fill({color:'rgba(232,14,14,'+opacity(acres)+')'}),stroke:new ol.style.Stroke({color:'rgba(232,14,14,1)',width:3}),})});newFiresStyleCache[acres]=style;}return(discovery>=(today-1.5*86400000))?[newFiresStyleCache[acres]]:fireStyles['Point'];}
var newFiresLayer=new ol.layer.Vector({title:'New Fires',source:new ol.source.Vector({format:new ol.format.GeoJSON(),url:'https://gbcc.us/newfires.geojson'}),visible:true,wrapX:false,style:newFiresStyleFunction});var ongoingFiresStyleCache={};var ongoingFiresStyleFunction=function(feature){var discovery=feature.get('FireDiscoveryDateTime');var acres=feature.get('DailyAcres')?feature.get('DailyAcres'):feature.get('DiscoveryAcres');var style=ongoingFiresStyleCache[acres];if(!style){style=new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:'rgba(254,253,6,'+opacity(acres)+')'}),stroke:new ol.style.Stroke({color:'rgba(254,253,6,1)',width:3}),radius:(acres<=18.5)?3.5:1.2*Math.log(acres)})});ongoingFiresStyleCache[acres]=style;}return(discovery>(today-30*86400000)&&discovery<(today-1.25*86400000))?style:fireStyles['Point'];};var ongoingFiresLayer=new ol.layer.Vector({title:'Ongoing Fires',source:new ol.source.Vector({format:new ol.format.GeoJSON(),url:'https://gbcc.us/ongoingfires.geojson'}),visible:true,wrapX:false,style:ongoingFiresStyleFunction});var teamFiresStyleCache={};var teamFiresStyleFunction=function(feature){var discovery=feature.get('FireDiscoveryDateTime');var acres=feature.get('DailyAcres')?feature.get('DailyAcres'):feature.get('DiscoveryAcres');var style=teamFiresStyleCache[acres];var alpha=opacity(acres)<0?.1:opacity(acres);if(!style){style=new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:'rgba(145,9,198,'+alpha+')'}),stroke:new ol.style.Stroke({color:'rgba(145,9,198,1)',width:3}),radius:(acres<=18.5)?3.5:1.2*Math.log(acres)})});teamFiresStyleCache[acres]=style;}return(discovery>(today-90*86400000)&&discovery<(today-1.25*86400000))?style:fireStyles['Point'];}
var teamFiresLayer=new ol.layer.Vector({title:'Team Fires',source:new ol.source.Vector({format:new ol.format.GeoJSON(),url:"https://irwin.doi.gov/arcgis/rest/services/Irwin/FeatureServer/0/query?f=geojson"+"&where=UniqueFireIdentifier = '2016-IDBOF-000539' OR UniqueFireIdentifier = '2016-ID8BN-003174'"+"&returnGeometry=true&spatialRel=esriSpatialRelIntersects&outFields=*&outSR=102100"+"&token="+irwin}),visible:false,wrapX:false,style:teamFiresStyleFunction});var image=new ol.style.Circle({radius:0,fill:null,stroke:new ol.style.Stroke({color:'blue',width:0})});var fireStyles={'Point':[new ol.style.Style({image:image})],'LineString':[new ol.style.Style({stroke:new ol.style.Stroke({color:'green',lineDash:[4],width:1})})],'MultiLineString':[new ol.style.Style({stroke:new ol.style.Stroke({color:'green',width:1})})],'MultiPoint':[new ol.style.Style({image:image,text:new ol.style.Text({text:'MP',stroke:new ol.style.Stroke({color:'purple'})})})],'MultiPolygon':[new ol.style.Style({stroke:new ol.style.Stroke({color:'yellow',width:1}),fill:new ol.style.Fill({color:'rgba(255, 255, 0, 0.1)'})})],'Polygon':[new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(255,40,249,1)',width:3}),fill:new ol.style.Fill({color:'rgba(255,40,249,.6)'})})],'GeometryCollection':[new ol.style.Style({stroke:new ol.style.Stroke({color:'magenta',width:2}),fill:new ol.style.Fill({color:'magenta'}),image:new ol.style.Circle({radius:10,fill:null,stroke:new ol.style.Stroke({color:'magenta'})})})],'Circle':[new ol.style.Style({stroke:new ol.style.Stroke({color:'red',width:2}),fill:new ol.style.Fill({color:'rgba(255,0,0,0.2)'})})]};var viirsStyles={'6':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(168,0,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(168,0,0,1)',width:1}),points:4,radius:4,angle:Math.PI/4})})],'12':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(230,77,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(230,77,0,1)',width:1}),points:4,radius:4,angle:Math.PI/4})})],'24':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,85,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,85,0,1)',width:1}),points:4,radius:4,angle:Math.PI/4})})],'48':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,169,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,169,0,1)',width:1}),points:4,radius:4,angle:Math.PI/4})})],};var igpointStyles={'6':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(168,0,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(168,0,0,1)',width:1}),points:3,radius:4,angle:0})})],'12':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(230,77,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(230,77,0,1)',width:1}),points:3,radius:4,})})],'24':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,85,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,85,0,1)',width:1}),points:3,radius:4,})})],'48':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,169,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,169,0,1)',width:1}),points:3,radius:4,})})],};var lightningStyles={'6':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(168,0,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(168,0,0,1)',width:2}),points:4,radius:6,radius2:0,angle:0})})],'12':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(230,77,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(230,77,0,1)',width:2}),points:4,radius:6,radius2:0,angle:0})})],'24':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,85,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,85,0,1)',width:2}),points:4,radius:6,radius2:0,angle:0})})],'48':[new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'rgba(255,169,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,169,0,1)',width:1}),points:4,radius:5,radius2:2,angle:0})})],};var egpModisStyles={'6':[new ol.style.Style({image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:'rgba(168,0,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(168,0,0,1)',width:1})})})],'12':[new ol.style.Style({image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:'rgba(230,77,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(230,77,0,1)',width:1})})})],'24':[new ol.style.Style({image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:'rgba(255,85,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,85,0,1)',width:1})})})],'48':[new ol.style.Style({image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:'rgba(255,169,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,169,0,1)',width:1})})})],'999':[new ol.style.Style({image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:'rgba(255,255,0,1)'}),stroke:new ol.style.Stroke({color:'rgba(255,255,0,1)',width:1})})})]};var opacity=function(acres){var fade=(acres<1000)?.1*Math.ceil(10*(1-.0004*Math.ceil(acres/100)*100)):1-.1*Math.floor(10*(.00012*Math.ceil(acres/100)*100+.4))<-1?.1:.1;return fade;}
var trackStyle=new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(0,0,255,1.0)',width:10,lineCap:'round'})});var trackSource=new ol.source.Vector({format:new ol.format.GeoJSON(),loader:function(extent,resolution,projection){var features=new ol.format.GeoJSON().readFeatures(gsPerims,{featureProjection:'EPSG:3857'});trackSource.addFeatures(features);}});var trackLayer=new ol.layer.Vector({title:"ol Perimeters",source:trackSource,style:trackStyle,visible:false});var camUrl="http://myers.seismo.unr.edu/firecams/proxy/getptz?get=1";var camConfig={method:'GET',url:camUrl,headers:{'Content-Type':'application/x-www-form-urlencoded'}};var polygons;var polyKeys;var camGJ={"type":"FeatureCollection","features":[]};var getCameras=function(extent,resolution,projection){ajax(camConfig).then(function(first){var json=JSON.parse(first)['features'];json.reduce(function(prev,curr,index){var cam={"type":"Feature","geometry":{"type":"Point","coordinates":[]},"properties":{}}
if(curr['properties']['fov']){cam['properties']["id"]=curr['properties']["id"];cam['properties']["name"]=curr['properties']["name"];cam['properties']["attribution"]=curr['properties']["attribution"];cam['properties']["region"]=curr['properties']["region"];cam['properties']["ip"]=curr['properties']["ip"];cam['properties']["fov"]=curr['properties']["fov"]?parseFloat(curr['properties']["fov"]):null;cam['properties']["fov_rt"]=curr['properties']["fov_rt"]?curr['properties']["fov_rt"].map(parseFloat):null;cam['properties']["fov_center"]=curr['properties']["fov_center"]?curr['properties']["fov_center"].map(parseFloat):null;cam['properties']["fov_lft"]=curr['properties']["fov_lft"]?curr['properties']["fov_lft"].map(parseFloat):null;cam['properties']["ptz"]=parseFloat(curr['properties']["ptz"]);cam['properties']["az_current"]=parseFloat(curr['properties']["az_current"]);cam['properties']["zoom_current"]=parseFloat(curr['properties']["zoom_current"]);cam['properties']["tilt_current"]=parseFloat(curr['properties']["tilt_current"]);cam['geometry']['coordinates']=curr['geometry']['coordinates'].map(parseFloat);prev.push(cam);}return prev;},camGJ['features']);var format=new ol.format.GeoJSON();features=format.readFeatures(camGJ);features.map(function(feature){return feature.getGeometry().transform('EPSG:4326','EPSG:3857');});nvBlmCamsLayer.getSource().addFeatures(features);polygons=camGJ['features'].reduce(function(prev,curr,index){var coords=[];Object.keys(curr['properties']).reduce(function(p,c){if(Array.isArray(curr['properties'][c])){p.push(curr['properties'][c]);}return p;},coords);coords.push([curr['geometry']['coordinates'][0],curr['geometry']['coordinates'][1],curr['geometry']['coordinates'][2]]);var fov=new ol.geom.Polygon([coords]);fov.set('id',curr['properties']['id']);prev.push(fov.transform('EPSG:4326','EPSG:3857'));return prev;},[]);var keyedUp=function(arr){var oo={};arr.map(function(curr){oo[curr.get('id')]=curr;})
return oo;}
polyKeys=keyedUp(polygons);}).catch(function(error){console.error('damnit.',error.statusText);});}
var nvBlmCamStyle=function(feature){return new ol.style.Style({image:new ol.style.Icon(({opacity:.75,scale:.4,src:'https://earth.google.com/images/kml-icons/track-directional/track-0.png',rotation:Math.PI*parseFloat(feature.getProperties()['az_current'])/180,rotateWithView:true}))});}
var nvBlmCamsLayer=new ol.layer.Vector({title:'NV BLM Cameras',source:new ol.source.Vector({loader:getCameras,wrapX:false}),projection:'EPSG:3857',style:nvBlmCamStyle,visible:false});var fovStyleCache={};var fovOverlay=new ol.layer.Vector({source:new ol.source.Vector(),style:function(feature,resolution){var id=feature.get('id');if(!fovStyleCache[id]){fovStyleCache[id]=new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(255, 166, 0, 1)',width:1}),fill:new ol.style.Fill({color:'rgba(255,0,0,0.3)'})});}return fovStyleCache[id];}});var geoMacSource=new ol.source.Vector({format:new ol.format.EsriJSON(),url:'https://gbcc.us/geomacperims.json'});var geomacPerimsLayer=new ol.layer.Vector({title:'GeoMAC Fire Perimeters',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,source:geoMacSource,style:new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(1,255,67,1)',width:3}),fill:new ol.style.Fill({color:'rgba(1,243,255,.2)'})}),visible:false});var vectorStyle=new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(89, 74, 48, 1)',width:2}),text:new ol.style.Text({font:'.9rem Montserrat, sans-serif',fill:new ol.style.Fill({color:'#000'})})});var vectorLayer=new ol.layer.Vector({title:'Local Dispatch Boundaries',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/gbccLocalWebsites.topojson',format:new ol.format.TopoJSON()}),wrapX:false,visible:true,style:function(feature,resolution){vectorStyle.getText().setText(resolution<5000?feature.get('GCA'):'');return vectorStyle;}});var openTopo=new ol.layer.Tile({title:'Open Topo',type:'base',visible:false,source:new ol.source.XYZ({attributions:'Tiles © <a href="https://opentopomap.org">OpenTopoMap</a>',url:'https://b.tile.opentopomap.org/{z}/{x}/{y}.png',crossOrigin:null})});var usgsTopo=new ol.layer.Tile({title:'USGS Topographic',type:'base',source:new ol.source.XYZ({url:'https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}'}),extent:[-14585849.855545742,4164163.9360093023,-11120670.513975333,5733155.322681262],visible:false});var bing=new ol.layer.Tile({title:'Bing Aerial',type:'base',source:new ol.source.BingMaps({key:bingToken,imagerySet:'AerialWithLabels'}),wrapX:false,visible:false});var raster=new ol.layer.Tile({title:'ESRI Raster',type:'base',source:new ol.source.XYZ({attributions:'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/'+'rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:'https://server.arcgisonline.com/ArcGIS/rest/services/'+'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'}),visible:false,wrapX:false});var mapbox=new ol.layer.Tile({title:'mapbox run-bike-hike',type:'base',source:new ol.source.XYZ({attributions:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> '+'© <a href="https://www.openstreetmap.org/copyright">'+'OpenStreetMap contributors</a>',crossOrigin:'anonymous',url:'https://api.tiles.mapbox.com/v4/mapbox.run-bike-hike/{z}/{x}/{y}.png?access_token='+mapboxToken}),wrapX:false,visible:false,});var mapboxDark=new ol.layer.Tile({title:'MapBox Dark',type:'base',source:new ol.source.XYZ({attributions:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> '+'© <a href="https://www.openstreetmap.org/copyright">'+'OpenStreetMap contributors</a>',crossOrigin:'anonymous',url:'https://api.tiles.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}.png?access_token='+mapboxToken}),visible:false,wrapX:false});var mapzen=new ol.layer.Tile({title:'MapZen',type:'base',source:new ol.source.XYZ({attributions:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> '+'© <a href="https://cartodb.com/attributions">CartoDB</a>',crossOrigin:'anonymous',url:'https://vector.mapzen.com/osm/earth/{z}/{x}/{y}.topojson?api_key='+'vector-tiles-kPYqqBF'}),visible:false,wrapX:false});var stamen=new ol.layer.Tile({title:'Stamen Terrain',type:'base',source:new ol.source.Stamen({layer:'terrain'}),crossOrigin:'anonymous',visible:true,});var clipStyle=new ol.style.Style({fill:new ol.style.Fill({color:'black'})});var clipLayer=new ol.layer.Image({source:new ol.source.ImageVector({source:new ol.source.Vector({url:'firecesium/examples/data/topojson/gbccBoundaries.topojson',format:new ol.format.TopoJSON()}),style:clipStyle})});clipLayer.on('postcompose',function(e){e.context.globalCompositeOperation='source-over';});clipLayer.on('precompose',function(e){e.context.globalCompositeOperation='destination-in';});var ownershipStyles={'FS':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(117, 181, 96, 0.5)'})})],'BLM':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(191, 140, 63, .5)'}),stroke:new ol.style.Stroke({color:'rgba(191, 140, 63, .5)',width:1})})],'statePrivate':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],'BIA':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],'NPS':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],'DOD':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],'DOE':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],'FWS':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(140, 149, 141, .5)'}),stroke:new ol.style.Stroke({color:'rgba(140, 149, 141, 1)',width:1})})],};var blm=new ol.layer.Vector({title:'BLM Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/blm.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['BLM']});var bia=new ol.layer.Vector({title:'BIA Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/bia.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['BIA']});var fs=new ol.layer.Vector({title:'FS Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/fs.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['FS']});var nps=new ol.layer.Vector({title:'NPS Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/nps.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['NPS']});var dod=new ol.layer.Vector({title:'DOD Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/dod.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['DOD']});var doe=new ol.layer.Vector({title:'DOE Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/doe.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['doe']});var fws=new ol.layer.Vector({title:'FWS Ownership',source:new ol.source.Vector({url:'firecesium/examples/data/topojson/ownership/fws.topojson',format:new ol.format.TopoJSON()}),wrapX:false,minResolution:0,maxResolution:5000,visible:false,style:ownershipStyles['FWS']});var sagegrouseStyles={'PGH':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(212, 82, 255, .8)'})})],'PPH':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(127, 0, 127, .8)'})})],'POH':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(12, 60, 138, .8)'})})],'PUH':[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(176, 205, 225, .8)'})})]};var sagegrouseSource=new ol.source.Vector({url:'firecesium/examples/data/topojson/sagegrouse.topojson',format:new ol.format.TopoJSON()});var sagegrouse=new ol.layer.Vector({title:'Sage-Grouse Habitat',wrapX:false,minResolution:0,maxResolution:5000,visible:true,style:function(feature,resolution){var feature=feature.get('Habitat_Ty');var style=sagegrouseStyles[feature];return style;}});sagegrouse.setSource(sagegrouseSource);var prepoLayer=new ol.layer.Vector({title:'Prepositioning',source:new ol.source.Vector({format:new ol.format.GeoJSON(),url:'firecesium/examples/data/geojson/prepo.geojson'}),visible:false,wrapX:false,style:new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:'#cfdb41'}),stroke:new ol.style.Stroke({color:'#222',width:1.5}),points:5,radius:7,radius2:4,angle:0})})});var igpointCentroidLayer6=new ol.layer.Vector({title:'IgPoint < 6 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:igpointStyles['6']});var igpointCentroidLayer12=new ol.layer.Vector({title:'IgPoint < 12 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:igpointStyles['12']});var igpointCentroidLayer24=new ol.layer.Vector({title:'IgPoint < 24 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:igpointStyles['24']});var igpointCentroidLayer48=new ol.layer.Vector({title:'IgPoint < 48 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:igpointStyles['48']});var viirsCentroidLayer6=new ol.layer.Vector({title:'VIIRS < 6 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:viirsStyles['6']});var viirsCentroidLayer12=new ol.layer.Vector({title:'VIIRS < 12 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:viirsStyles['12']});var viirsCentroidLayer24=new ol.layer.Vector({title:'VIIRS < 24 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:viirsStyles['24']});var viirsCentroidLayer48=new ol.layer.Vector({title:'VIIRS < 48 Hour',extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:viirsStyles['48']});var ltSource6=new ol.source.Vector({});var ltSource12=new ol.source.Vector({});var ltSource24=new ol.source.Vector({});var lightningLayer6=new ol.layer.Vector({extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:lightningStyles['6']});var lightningLayer12=new ol.layer.Vector({extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:lightningStyles['12']});var lightningLayer24=new ol.layer.Vector({extent:[-13385849.855545742,4164163.9360093023,-12120670.513975333,5733155.322681262],wrapX:false,visible:false,style:lightningStyles['24']});var map;var ol3d;var map3d=document.getElementById('map3d');var container=document.getElementById('popup');var content=document.getElementById('popup-content');var closer=document.getElementById('popup-closer');var rCloser=document.getElementById('resources-closer');var toggle=document.getElementById('toggle');var fstitle=document.getElementById('fs-title');fstitle.style.width='250px',fstitle.style.height='166px'
document.addEventListener("fullscreenchange",function(e){if(document.fullscreenEnabled){document.fullscreenElement?((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='20%',maps.style.width='80%',fstitle.style.display='block',fstitle.style.width='250px',fstitle.style.height='166px',side1.innerHTML=tabthree.innerHTML,tabthree.innerHTML='',resetVar()):((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='0%',maps.style.width='100%',fstitle.style.width='',fstitle.style.height='',fstitle.style.display='none',tabthree.innerHTML=side1.innerHTML,side1.innerHTML='',resetVar());}},false);document.addEventListener("MSFullscreenChange",function(e){if(document.msFullscreenEnabled){document.msFullscreenElement?((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='20%',maps.style.width='80%',fstitle.style.display='block',fstitle.style.width='250px',fstitle.style.height='166px',side1.innerHTML=tabthree.innerHTML,tabthree.innerHTML='',resetVar()):((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='0%',maps.style.width='100%',fstitle.style.width='',fstitle.style.height='',fstitle.style.display='none',tabthree.innerHTML=side1.innerHTML,side1.innerHTML='',resetVar());}},false);document.addEventListener("mozfullscreenchange",function(e){if(document.mozFullScreenEnabled){document.mozFullScreenElement?((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='20%',maps.style.width='80%',fstitle.style.display='block',fstitle.style.width='250px',fstitle.style.height='166px',side1.innerHTML=tabthree.innerHTML,tabthree.innerHTML='',resetVar()):((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='0%',maps.style.width='100%',fstitle.style.width='',fstitle.style.height='',fstitle.style.display='none',tabthree.innerHTML=side1.innerHTML,side1.innerHTML='',resetVar());}},false);document.addEventListener("webkitfullscreenchange",function(e){if(document.webkitFullscreenEnabled){document.webkitFullscreenElement?((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='20%',maps.style.width='80%',fstitle.style.display='block',fstitle.style.width='250px',fstitle.style.height='166px',side1.innerHTML=tabthree.innerHTML,tabthree.innerHTML='',resetVar()):((camBox!==undefined)?(nvcams.setTarget(),maps.removeChild(camBox),camBox=undefined):'',sidepanel.style.width='0%',maps.style.width='100%',fstitle.style.width='',fstitle.style.height='',fstitle.style.display='none',tabthree.innerHTML=side1.innerHTML,side1.innerHTML='',resetVar());}},false);var App={};App.verticalSlide=function(element,container,easing,duration){var el=document.querySelector(element),con=document.querySelector(container),up='slideUp',down='slideDown';el.addEventListener('click',function(event){var active=el.classList.contains('active');el.classList.toggle('active');Velocity(con,active?up:down,{duration:duration,easing:easing});event.preventDefault();});};window.onload=function(){App.verticalSlide('.drawer-button','.drawer','easeOutCirc',300);};ol.control.LayerSwitcher=function(opt_options){var options=opt_options||{};var tipLabel=options.tipLabel?options.tipLabel:'Legend';this.mapListeners=[];this.hiddenClassName='ol-unselectable ol-control layer-switcher';if(ol.control.LayerSwitcher.isTouchDevice_()){this.hiddenClassName+=' touch';}this.shownClassName=this.hiddenClassName+' shown';var element=document.createElement('div');element.className=this.hiddenClassName;var button=document.createElement('button');button.setAttribute('title',tipLabel);element.appendChild(button);this.panel=document.createElement('div');this.panel.className='panel';element.appendChild(this.panel);ol.control.LayerSwitcher.enableTouchScroll_(this.panel);var this_=this;button.onmouseover=function(e){this_.showPanel();};button.onclick=function(e){e=e||window.event;this_.showPanel();e.preventDefault();};this_.panel.onmouseout=function(e){e=e||window.event;if(!this_.panel.contains(e.toElement||e.relatedTarget)){this_.hidePanel();}};ol.control.Control.call(this,{element:element,target:options.target});};ol.inherits(ol.control.LayerSwitcher,ol.control.Control);ol.control.LayerSwitcher.prototype.showPanel=function(){if(this.element.className!=this.shownClassName){this.element.className=this.shownClassName;this.renderPanel();}};ol.control.LayerSwitcher.prototype.hidePanel=function(){if(this.element.className!=this.hiddenClassName){this.element.className=this.hiddenClassName;}};ol.control.LayerSwitcher.prototype.renderPanel=function(){this.ensureTopVisibleBaseLayerShown_();while(this.panel.firstChild){this.panel.removeChild(this.panel.firstChild);}var ul=document.createElement('ul');this.panel.appendChild(ul);this.renderLayers_(this.getMap(),ul);};ol.control.LayerSwitcher.prototype.setMap=function(map){for(var i=0,key;i<this.mapListeners.length;i++){this.getMap().unByKey(this.mapListeners[i]);}this.mapListeners.length=0;ol.control.Control.prototype.setMap.call(this,map);if(map){var this_=this;this.mapListeners.push(map.on('pointerdown',function(){this_.hidePanel();}));this.renderPanel();}};ol.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var lastVisibleBaseLyr;ol.control.LayerSwitcher.forEachRecursive(this.getMap(),function(l,idx,a){if(l.get('type')==='base'&&l.getVisible()){lastVisibleBaseLyr=l;}});if(lastVisibleBaseLyr)this.setVisible_(lastVisibleBaseLyr,true);};ol.control.LayerSwitcher.prototype.setVisible_=function(lyr,visible){var map=this.getMap();lyr.setVisible(visible);if(visible&&lyr.get('type')==='base'){ol.control.LayerSwitcher.forEachRecursive(map,function(l,idx,a){if(l!=lyr&&l.get('type')==='base'){l.setVisible(false);}});}};ol.control.LayerSwitcher.prototype.renderLayer_=function(lyr,idx){var this_=this;var li=document.createElement('li');var lyrTitle=lyr.get('title');var lyrId=ol.control.LayerSwitcher.uuid();var label=document.createElement('label');if(lyr.getLayers&&!lyr.get('combine')){li.className='group';label.innerHTML=lyrTitle;li.appendChild(label);var ul=document.createElement('ul');li.appendChild(ul);this.renderLayers_(lyr,ul);}else{li.className='layer';var input=document.createElement('input');if(lyr.get('type')==='base'){input.type='radio';input.name='base';}else{input.type='checkbox';}input.id=lyrId;input.checked=lyr.get('visible');input.onchange=function(e){this_.setVisible_(lyr,e.target.checked);};li.appendChild(input);label.htmlFor=lyrId;label.innerHTML=lyrTitle;li.appendChild(label);}return li;};ol.control.LayerSwitcher.prototype.renderLayers_=function(lyr,elm){var lyrs=lyr.getLayers().getArray().slice().reverse();for(var i=0,l;i<lyrs.length;i++){l=lyrs[i];if(l.get('title')){elm.appendChild(this.renderLayer_(l,i));}}};ol.control.LayerSwitcher.forEachRecursive=function(lyr,fn){lyr.getLayers().forEach(function(lyr,idx,a){fn(lyr,idx,a);if(lyr.getLayers){ol.control.LayerSwitcher.forEachRecursive(lyr,fn);}});};ol.control.LayerSwitcher.uuid=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});}
ol.control.LayerSwitcher.enableTouchScroll_=function(elm){if(ol.control.LayerSwitcher.isTouchDevice_()){var scrollStartPos=0;elm.addEventListener("touchstart",function(event){scrollStartPos=this.scrollTop+event.touches[0].pageY;},false);elm.addEventListener("touchmove",function(event){this.scrollTop=scrollStartPos-event.touches[0].pageY;},false);}};ol.control.LayerSwitcher.isTouchDevice_=function(){try{document.createEvent("TouchEvent");return true;}catch(e){return false;}};var exportPNGElement=document.getElementById('export-png');if('download'in exportPNGElement){exportPNGElement.addEventListener('click',function(){map.once('postcompose',function(event){var canvas=event.context.canvas;exportPNGElement.href=canvas.toDataURL('image/png');});map.renderSync();},false);}else{var download=document.getElementById('download');download.style.display='none';}
<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link rel="stylesheet" type="text/css" href="styles.css">
<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../ol.css" type="text/css"></link>
<link rel="stylesheet" type="text/css" href="styles.css"></link>
<link rel="stylesheet" type="text/css" href="pikaday.css">
<!-- <script src="http://d3js.org/d3.v3.min.js"></script> -->
<html>
<head>
	<title></title>
<style type="text/css">

.pika-single.dark-theme {
  color: #fff;
  background: #333;
  border: 1px solid #666;
  border-bottom-color: #999;
}
  .dark-theme .pika-label {
    background-color: #333;
  }
  .dark-theme .pika-prev,
  .dark-theme .is-rtl .pika-next {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAQAAACGG/bgAAAAQ0lEQVR4Ae3KIQ4AIBTD0N0/IeHGI3UIRA3ut/Zl+ltXc5++htVAmIAwAWECwgSEKbgthEoIlRAqIVRCqINQB9nDgQd7ktwFo6UpWQAAAABJRU5ErkJggg==');
  }
  .dark-theme .pika-next,
  .dark-theme .is-rtl .pika-prev {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAQAAACGG/bgAAAAP0lEQVQ4y+3TMQoAMAgEwfwfAvvjTZ1uGzuvHhBPPGczEG+FRqqRaqQaqUaqkX6QBmmjacvQ6qEVTjsh+xizebvlaWptGXZAAAAAAElFTkSuQmCC');
  }
  .dark-theme .pika-table th {
    color: #999;
  }
  .dark-theme .pika-button {
    color: #fff;
    background: #222;
  }
  .dark-theme .pika-week {
    color: #999;
  }
  .dark-theme .is-today .pika-button {
    color: #33aaff;
  }
  .dark-theme .is-selected .pika-button {
    color: #fff;
    background: #33aaff;
    box-shadow: inset 0 1px 3px #178fe5;
  }
  .dark-theme .is-disabled .pika-button {
    color: #999;
    opacity: .3;
  }
  .dark-theme .pika-button:hover {
    color: #fff !important;
    background: #ff8000 !important;
  }

.play {
  font-family: inherit;
  font-size: inherit;
  padding: 2px 5px;
  color: #fff;
  background-color: rgba(67,87,104,.5);
  margin: .5rem 0  0rem 0;
  letter-spacing: 1px;
  font-weight: 700;
  outline: none;
  left: 28em;
  bottom: .5em;
  width: 85px;
}

.pickStart {
  font-family: inherit;
  font-size: inherit;
  color: #fff;
  background-color: rgba(67,87,104,.5);
  outline: none;
  left: .5em;
  bottom: .5em;
}
.pickEnd {
  font-family: inherit;
  font-size: inherit;
  color: #fff;
  background-color: rgba(67,87,104,.5);
  outline: none;
  left: 14em;
  bottom: .5em;
}
label {
  display:inline-block;
}
#slider {
  margin:50px;
}
</style>
</head>
<body>
<div id="map" style="height: 90vh;"></div>
<button id='toggle' class="toggle-button" style="display: none;">â˜°</button>
<div id="map3d" class="dontsee"></div>
<button id="playButton"></button>
<h1>Select Date via Slider (thus the need for archival data)</h1>
<div id="slider"></div>
<label>
  <h5>Start</h5>
  <input id="start" type="date" value="1910-01-01" />
</label>
<label>
  <h5>End</h5>
  <input id="end" type="date" value="2060-01-01" />
</label>
<label>
  <h5>Format</h5>
  <input id="format" type="text" value="Y M, d" />
</label>
<label>
  <h5>Current (formatted)</h5>
  <input id="current" readonly="readonly" type="text" />
</label>
<script src="pikaday.js"></script>
<script src="../Cesium/Cesium.js"></script>
<script src="../ol3cesium.js"></script>
<script src="rawsVoronoi1.js"></script>
<script type="text/javascript">
  var DateFormatter = {
  date_text : {
    'D' : ['Sun', 'Mon', 'Tue', 'Wed', 
      'Thu', 'Fri', 'Sat'],
    'l' : ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 
      'Thursday', 'Friday', 'Saturday'],
    'F' : ['January','February','March','April','May',
      'June','July','August','September','October',
      'November','December'],
    'M' : ['Jan','Feb','Mar','Apr','May',
      'Jun','Jul','Aug','Sep','Oct',
      'Nov','Dec'],
  },
  format : {
    // seconds / timestamp
        'U' : function (date) {
            return String( Math.round( date.getTime() / 1000 ) );
        },
    'j' : function (date) {
      return String( date.getDate() );
    },
    'd' : function (date) {
      var dom = DateFormatter.format['j']( date );
      if (dom.length === 1) {
        return '0' + dom;
      }
      return dom;
    },
    'w' : function (date) {
      return String(date.getDay());
    },
    'D' : function (date) {
      return DateFormatter.date_text['D'][ DateFormatter.format['w']( date ) ];
    },
    'l' : function (date) {
      return DateFormatter.date_text['l'][ DateFormatter.format['w']( date ) ];
    },
    'n' : function (date) {
      return String(date.getMonth() + 1);
    },
    'F' : function (date) {
      return DateFormatter.date_text['F'][ DateFormatter.format['n']( date ) - 1 ];
    },
    'M' : function (date) {
      return DateFormatter.date_text['M'][ DateFormatter.format['n']( date ) - 1 ];
    },
    'm' : function (date) {
      var month = DateFormatter.format['n']( date );
      if (month.length === 1) {
        return '0' + month;
      }
      return month;
    },
    'Y' : function (date) {
      return String( date.getFullYear() );
    },
    'y' : function (date) {
      return DateFormatter.format['Y']( date ).substr(2, 2);
    },  
    // decade  
        'X' : function (date) {
            return String( Math.floor( date.getFullYear() / 10 ) * 10 );
        }   
  },
  parseString : function (str, date) {
    var keys = Object.keys( this.format ).join(''),
      regex = new RegExp('\\b[' + keys + ']\\b', 'g'),
      matches = str.match( regex );
    
    if (!matches) return str;
    
    for (var i = 0, len = matches.length; i < len; i++) {
      var match = matches[i],
        regex = new RegExp('\\b' + match + '\\b', 'g'),
        fnc = this.format[ match ];
      str = str.replace(regex, function () {
        return fnc( date );
      });
    }
    return str;
  }
};

function Slider (elem, options) {
  this.elem = elem;
  this.options = options || {};
  this.reset();
  this.ready = true;
  
  // events
  this.onChangeHandlers = [];
}

Slider.prototype.reset = function () {
  this.setRange(this.options.min || 0, this.options.max || 100);
  this.createElements();
  this.addEvents();
  
  this.updateHelper( this.getPercent() );
  
  if (this.options.format) {
    this.setFormat(this.options.format);
  }
  
};

Slider.prototype.setRange = function (min, max) {
  this.range = [
    min || 0, 
    max || 100
  ];
  if (this.ready) {
    this.updateHelper(this.getPercent());
  }
};

Slider.prototype.setFormat = function ( format ) {
  this.format = format;
  if (this.ready) {
    this.updateHelper(this.getPercent());
  }
};

Slider.prototype.createElements = function () {
  var height = '100px';
      
  // container
  this.elem.style.width = '100%'; 
  this.elem.style.height = height;
  this.elem.style.cursor = 'ew-resize'; 
  this.elem.style.position = 'relative';  
  
  // background
  this.sliderbg = document.createElement('div');
  this.sliderbg.style.width = '75%';  
  this.sliderbg.style.height = height;
  this.sliderbg.style.background = '#39C';
  this.sliderbg.style.cursor = 'ew-resize'; 
  this.sliderbg.style.position = 'relative';  
  
  // slider
  this.slider = document.createElement('div');
  this.slider.style.width = '50%';
  this.slider.style.height = '100%';
  this.slider.style.background = 'rgba(0,0,0,0.1)';
  this.slider.style.position = 'absolute';
  this.slider.style.top = 0;
  this.slider.style.left = 0;
  this.slider.style.pointerEvents = 'none';
  
  // slider hover
  this.hoverslider = document.createElement('div');
  this.hoverslider.style.width = '50%';
  this.hoverslider.style.height = '100%';
  this.hoverslider.style.background = 'rgba(0,0,0,0.025)';
  this.hoverslider.style.position = 'absolute';
  this.hoverslider.style.top = 0;
  this.hoverslider.style.left = 0;
  this.hoverslider.style.display = 'block';
  this.hoverslider.style.pointerEvents = 'none';
  
  // slider hover helper/label/tip
  this.hoverhelperholder = document.createElement('div');
  this.hoverhelperholder.style.position = 'absolute';
  this.hoverhelperholder.style.bottom = 0;
  this.hoverhelperholder.style.right = 0;
  this.hoverhelperholder.style.marginBottom = height;
  
  this.hoverhelper = document.createElement('div');
  this.hoverhelper.style.position = 'relative';
  this.hoverhelper.style.padding = '5px';
  this.hoverhelper.style.background = 'black';
  this.hoverhelper.style.color = 'white';
  this.hoverhelper.style.left = '50%';
  this.hoverhelper.style.whiteSpace = 'nowrap';
  
  this.hoverhelperholder.appendChild( this.hoverhelper );
  this.hoverslider.appendChild( this.hoverhelperholder );
  this.sliderbg.appendChild( this.slider );
  this.sliderbg.appendChild( this.hoverslider );
  this.elem.appendChild( this.sliderbg );
};

Slider.prototype.getWidthRange = function () {
  return [
    0,
    this.sliderbg.offsetWidth
  ];
};

Slider.prototype.handleMouseEvent = function (e) {
  if (e.offsetX < 0) {
    if (this.ismousedown) {
      this.setPercent( 0 );
    }
    this.moveHover(0);
  } else if (e.offsetX > this.sliderbg.offsetWidth) {
    if (this.ismousedown) {
      this.setPercent( 100 );
    }
    this.moveHover(100);
  } else {
    if (this.ismousedown) {
      this.setPercent( this.getPercentFromEvent( e ) );
    }
    this.moveHover(this.getPercentFromEvent( e ));
  }
};

Slider.prototype.addEvents = function () {
  var _this = this;
    
  this.sliderbg.addEventListener('mousedown', function (e) {
    _this.ismousedown = true;
    _this.setPercent( _this.getPercentFromEvent( e ) ); 
    
    document.addEventListener('mouseup', function (_e) {
      _this.ismousedown = false;
      document.removeEventListener('mouseup', arguments.callee);
    });
    
  });
  
  this.sliderbg.addEventListener('mouseenter', function (e) {
    _this.handleMouseEvent.call( _this, e );
    _this.hoverslider.style.display = 'block';
    _this.hoverhelper.style.display = 'block';
  });
  
  this.sliderbg.addEventListener('mouseleave', function (e) {
    _this.handleMouseEvent.call( _this, e );
    _this.hoverslider.style.display = 'none';
    _this.hoverhelper.style.display = 'none';
  });
  
  this.sliderbg.addEventListener('mousemove', function (e) {
    _this.handleMouseEvent.call( _this, e );
    _this.hoverslider.style.display = 'block';
    _this.hoverhelper.style.display = 'block';
  });
};

Slider.prototype.getPercentFromEvent = function (e) {
  var x = e.offsetX,
    width = this.sliderbg.offsetWidth;
  return (x / width) * 100;
};

Slider.prototype.getPercent = function () {
  var percent = this.slider.style.width;
  return Number(percent.substr(0,percent.length - 1));
};

Slider.prototype.setPercent = function (percent) {
  this.slider.style.width = percent + '%';
  this.triggerChange();
};

Slider.prototype.triggerChange = function () {
  var changeHandlers = this.onChangeHandlers;
  for (var i = 0, len = changeHandlers.length; i < len; i++) {
    changeHandlers[ i ]();
  }
};

Slider.prototype.onChange = function ( fnc ) {
  this.onChangeHandlers.push( fnc.bind( this ) );
};

Slider.prototype.moveHover = function (percent) {
  this.hoverslider.style.width = percent + '%';
  
  this.updateHelper( percent );
};

Slider.prototype.updateHelper = function (percent) {
  var value = this.translateToValue( percent );
  if (this.options.type) {
    value = this[this.options.type + 'format']( value );
  }
  this.hoverhelper.innerHTML = value;
};

Slider.prototype.set = function (value) {
  this.setPercent( this.translateToPercent( value ) );
};

Slider.prototype.get = function () {
  return this.translateToValue( this.getPercent() );
};

Slider.prototype.getFormatted = function () {
  var value = this.get();
  if (this.format) {
    return this[this.options.type + 'format']( value );
  }
  return value;
};

Slider.prototype.translateToValue = function (percent) {
  return linearInterpolate(percent, [0, 100], this.range);
};

Slider.prototype.translateToPercent = function (value) {
  return linearInterpolate(value, this.range, [0, 100]);
};

Slider.prototype.dateformat = function ( value ) {
  var format = this.format || 'M d, Y',
    time = value || this.get(),
    date = new Date(time);
  return DateFormatter.parseString(format, date);
};

var start = document.getElementById('start');
var end = document.getElementById('end');
var format = document.getElementById('format');
var current = document.getElementById('current');

var slider = new Slider(document.getElementById('slider'), {
  type: 'date',
  format: format.value,
  min : dateInputToTimeStamp( start ),
  max : dateInputToTimeStamp( end )
});

slider.onChange(function () {
  current.value = slider.getFormatted();
});

slider.set(0);

format.addEventListener('change', function () {
  slider.setFormat( format.value );
});

start.addEventListener('change', rangeChange);
end.addEventListener('change', rangeChange);

function rangeChange () {
  slider.setRange(dateInputToTimeStamp( start ), dateInputToTimeStamp( end ));
}

function dateInputToTimeStamp (input) {
  var value = input.value,
    ymd = value.split('-'),
    mdy = ymd[1] + '/' + ymd[2] + '/' + ymd[0];
  return (new Date( mdy )).getTime();
}

function linearList (min, max, len) {
    var interpolated = [];
    var range = max - min;
    var diff = range / (len - 1);
    var value = +min;
    for (var i = 0; i < len; i++) {
        interpolated.push(value);
        value += diff;
    }
    return interpolated;
}

function linearInterpolate (val, from_range, to_range) {
    if (from_range.indexOf(val) !== -1) {
        // just return the value
        return to_range[from_range.indexOf(val)];
    }
    if (val < from_range[0]) {
        return to_range[0];
    }
    if (val > from_range[from_range.length - 1]) {
        return to_range[to_range.length - 1];
    }
    if (from_range.length > 2) {
        // get subsections
        var ranges = (function () {
                from_range.sort();
                for (var i = 0, len = from_range.length; i < len; i++) {
                    var item = from_range[i];
                    if (item > val) {
                        return [
                            from_range.slice(i - 1, i + 1),
                            to_range.slice(i - 1, i + 1),
                        ];
                    }
                }
            })(),
            from_range = ranges[0],
            to_range = ranges[1];
    }
    // ready
    var minX = from_range[0],
        minY = to_range[0],
        rangeX = from_range[1] - from_range[0],
        rangeY = to_range[1] - to_range[0];

    return (val - minX) * rangeY / rangeX + minY;
}
</script>
</body>
</html>